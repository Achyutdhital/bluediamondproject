{% extends "app/base.html" %}
{% load static %}

{% block title %}{{ service.name }} - {{ company.company_name|default:'Blue Diamond Service Center' }}{% endblock %}

{% block meta_description %}{{ service.content|truncatewords:25 }} - Professional {{ service.name }} services by {{ company.company_name|default:'Blue Diamond Service Center' }}.{% endblock %}

{% block content %}

{% url 'services' as services_url %}
{% include 'app/components/page_header.html' with title=service.name parent_title='Services' parent_url=services_url %}



<!-- Service Detail Section -->
<section class="service-detail-section">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-7">
                <div class="service-detail-content">
                    {% if service.feature_image %}
                    <div class="service-image" style="margin-bottom: 30px;">
                        <img src="{{ service.feature_image.url }}" alt="{{ service.name }}" style="width: 100%; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    </div>
                    {% endif %}
                    
                    <div class="service-content">
                        <h2 style="color: #1e3c72; font-size: 32px; font-weight: 700; margin-bottom: 20px;">{{ service.name }}</h2>
                        <p style="color: #666; font-size: 18px; line-height: 1.8; margin-bottom: 25px;">{{ service.content }}</p>
                        
                        <div class="service-description" style="color: #555; line-height: 1.7;">
                            {{ service.description|safe }}
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4 col-md-5">
                <div class="service-sidebar-wrapper" style="position: relative;">
                    <div class="service-sidebar sticky-sidebar">
                        <!-- Quick Contact -->
                    <div class="sidebar-widget text-center">
                        <h3 class="widget-title">Need This Service?</h3>
                        <p class="widget-text">Get professional {{ service.name }} service today!</p>
                        <a href="{% url 'enquiry' %}?service={{ service.slug }}" class="btn-cta">
                            <i class="fas fa-phone" style="margin-right: 8px;"></i>
                            Get Quote Now
                        </a>
                    </div>
                    
                    <!-- Other Services -->
                    <div class="sidebar-widget">
                        <h3 class="widget-title">Other Services</h3>
                        <ul class="links">
                            {% for other_service in other_services %}
                            <li>
                                <a href="/services/{{ other_service.slug }}/">
                                    <i class="fas fa-chevron-right"></i>
                                    {{ other_service.name }}
                                </a>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    
                    <!-- Contact Info -->
                    <div class="sidebar-widget">
                        <h3 class="widget-title">Contact Info</h3>
                        <ul class="contact-list">
                            <li>
                                <i class="fas fa-phone"></i>
                                <a href="tel:{{ company.phone_number }}">{{ company.phone_number|default:'+977-1-XXXXXXX' }}</a>
                            </li>
                            <li>
                                <i class="fas fa-envelope"></i>
                                <a href="mailto:{{ company.email }}">{{ company.email|default:'info@bluediamond.com' }}</a>
                            </li>
                            <li>
                                <i class="fas fa-map-marker-alt"></i>
                                <span>{{ company.address|default:'Kathmandu, Nepal' }}</span>
                            </li>
                        </ul>
                    </div>
                </div>
                </div>
            </div>
        </div>
    </div>
 </section>

<style>
.service-detail-section { padding: 60px 0; background: #fff; }
.service-detail-content { background: #fff; border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
/* Sidebar card styles (match blog detail look) */
.service-sidebar .sidebar-widget { background:#fff; border-radius:20px; padding:20px; box-shadow:0 10px 30px rgba(0,0,0,0.08); margin-bottom:25px; }
.service-sidebar .widget-title { font-weight:700; color:#1e293b; margin:0 0 15px; font-size:22px; }
.service-sidebar .widget-text { color:#64748b; margin-bottom:18px; }
.service-sidebar .btn-cta { background: linear-gradient(135deg, #1e3c72 60%, #2563eb 100%); color:#fff; padding:12px 24px; border-radius:30px; text-decoration:none; font-weight:700; display:inline-block; transition:transform .2s, box-shadow .2s; }
.service-sidebar .btn-cta:hover { transform: translateY(-2px); box-shadow:0 6px 18px rgba(30,60,114,0.25); color:#fff; }
.service-sidebar .links { list-style:none; padding:0; margin:0; }
.service-sidebar .links li a { color:#475569; text-decoration:none; display:block; padding:10px 0; border-bottom:1px solid #f1f5f9; transition:color .2s; }
.service-sidebar .links li:last-child a { border-bottom:none; }
.service-sidebar .links li a i { margin-right:8px; color:#1e3c72; }
.service-sidebar .links li a:hover { color:#1e3c72; }
.service-sidebar .contact-list { list-style:none; padding:0; margin:0; }
.service-sidebar .contact-list li { display:flex; align-items:center; gap:10px; color:#475569; padding:8px 0; border-bottom:1px solid #f1f5f9; }
.service-sidebar .contact-list li:last-child { border-bottom:none; }
.service-sidebar .contact-list i { color:#1e3c72; width:18px; text-align:center; }
.service-sidebar .contact-list a { color:#475569; text-decoration:none; }
.service-sidebar .contact-list a:hover { color:#1e3c72; }
@media (max-width: 768px) {
    .service-detail-content { padding: 20px; }
}
</style>

<script>
// Intelligent Sticky Sidebar
$(document).ready(function(){
    var $sidebar = $('.sticky-sidebar');
    var $sidebarWrapper = $sidebar.parent();
    var $contentColumn = $('.service-detail-content').closest('.col-lg-8, .col-md-7');
    var lastScrollTop = 0;
    var sidebarOffset = 0;
    
    if ($sidebar.length && $contentColumn.length) {
        function updateSidebar() {
            if ($(window).width() <= 991) {
                $sidebar.css({ 'position': 'static', 'width': 'auto', 'top': 'auto' });
                return;
            }
            
            var scrollTop = $(window).scrollTop();
            var windowHeight = $(window).height();
            var sidebarHeight = $sidebar.outerHeight();
            var sidebarTop = $sidebarWrapper.offset().top;
            var contentBottom = $contentColumn.offset().top + $contentColumn.outerHeight();
            var scrollDirection = scrollTop > lastScrollTop ? 'down' : 'up';
            var headerOffset = 100;
            
            // Stop point: don't let sidebar go below content
            var stopPoint = contentBottom - sidebarHeight - 20;
            
            if (sidebarHeight <= windowHeight - headerOffset) {
                // SHORT SIDEBAR: Stick to top
                var startPoint = sidebarTop - headerOffset;
                if (scrollTop >= startPoint && scrollTop < stopPoint) {
                    $sidebar.css({ 'position': 'fixed', 'top': headerOffset + 'px', 'width': $sidebarWrapper.width() + 'px' });
                } else if (scrollTop >= stopPoint) {
                    $sidebar.css({ 'position': 'absolute', 'top': (stopPoint - sidebarTop) + 'px', 'width': $sidebarWrapper.width() + 'px' });
                } else {
                    $sidebar.css({ 'position': 'static', 'width': 'auto', 'top': 'auto' });
                }
            } else {
                // TALL SIDEBAR: Intelligent scrolling
                var sidebarRect = $sidebar[0].getBoundingClientRect();
                var sidebarVisibleTop = sidebarRect.top;
                var sidebarVisibleBottom = sidebarRect.bottom;
                
                if (scrollTop >= stopPoint) {
                    // Lock at content bottom
                    $sidebar.css({ 'position': 'absolute', 'top': (stopPoint - sidebarTop) + 'px', 'width': $sidebarWrapper.width() + 'px' });
                    sidebarOffset = 0;
                } else if (scrollDirection === 'down') {
                    // Scrolling down: stick bottom when it reaches viewport bottom
                    if (sidebarVisibleBottom <= windowHeight) {
                        $sidebar.css({ 'position': 'fixed', 'top': (windowHeight - sidebarHeight) + 'px', 'width': $sidebarWrapper.width() + 'px' });
                        sidebarOffset = scrollTop - (sidebarTop - (windowHeight - sidebarHeight));
                    }
                } else {
                    // Scrolling up: stick top when it reaches viewport top
                    if (sidebarVisibleTop >= headerOffset) {
                        $sidebar.css({ 'position': 'fixed', 'top': headerOffset + 'px', 'width': $sidebarWrapper.width() + 'px' });
                        sidebarOffset = scrollTop - (sidebarTop - headerOffset);
                    }
                }
                
                // Reset to static if scrolled back to original position
                if (scrollTop <= sidebarTop - headerOffset) {
                    $sidebar.css({ 'position': 'static', 'width': 'auto', 'top': 'auto' });
                    sidebarOffset = 0;
                }
            }
            
            lastScrollTop = scrollTop;
        }
        
        $(window).on('scroll resize', updateSidebar);
        updateSidebar();
    }
});
</script>

<!-- Related Services -->
{% if related_services %}
<section style="background: #fff; padding: 60px 0;">
    <div class="container">
        <h2 style="text-align: center; color: #1e3c72; font-size: 32px; font-weight: 700; margin-bottom: 40px;">Related Services</h2>
        <div class="row">
            {% for related in related_services %}
            <div class="col-md-4" style="margin-bottom: 30px;">
                <div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: transform 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                    {% if related.feature_image %}
                    <img src="{{ related.feature_image.url }}" alt="{{ related.name }}" style="width: 100%; height: 200px; object-fit: cover;">
                    {% endif %}
                    <div style="padding: 20px;">
                        <h4 style="color: #1e3c72; margin-bottom: 10px;">{{ related.name }}</h4>
                        <p style="color: #666; font-size: 14px; margin-bottom: 15px;">{{ related.content|truncatewords:15 }}</p>
                        <a href="/services/{{ related.slug }}/" style="color: #1e3c72; text-decoration: none; font-weight: 600;">Learn More <i class="fas fa-arrow-right" style="margin-left: 5px;"></i></a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

{% endblock %}