{% load static %}
<!-- SEO Meta Tags -->
<title>{% block title %}{{ page_seo.meta_title|default:default_seo.default_title }}{% endblock %}</title>
<meta name="description" content="{% block meta_description %}{{ page_seo.meta_description|default:default_seo.default_description }}{% endblock %}">
<meta name="keywords" content="{% block meta_keywords %}{{ page_seo.meta_keywords|default:default_seo.default_keywords }}{% endblock %}">
<meta name="author" content="{{ company.company_name|default:'Blue Diamond Service Center' }}">
<meta name="robots" content="{% block robots %}{{ page_seo.robots|default:'index, follow' }}{% endblock %}">

<!-- Canonical URL -->
{% block canonical %}<link rel="canonical" href="{% if page_seo.canonical_url %}{{ page_seo.canonical_url }}{% else %}{{ request.build_absolute_uri }}{% endif %}">{% endblock %}

<!-- Open Graph / Facebook -->
<meta property="og:type" content="{% block og_type %}{{ page_seo.og_type|default:'website' }}{% endblock %}">
<meta property="og:site_name" content="{{ default_seo.site_name|default:'Blue Diamond Service Center' }}">
<meta property="og:title" content="{% block og_title %}{{ page_seo.get_og_title|default:default_seo.default_title }}{% endblock %}">
<meta property="og:description" content="{% block og_description %}{{ page_seo.get_og_description|default:default_seo.default_description }}{% endblock %}">
<meta property="og:url" content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}">
<meta property="og:image" content="{% block og_image %}{% if page_seo.og_image %}{{ request.scheme }}://{{ request.get_host }}{{ page_seo.og_image.url }}{% elif default_seo.default_og_image %}{{ request.scheme }}://{{ request.get_host }}{{ default_seo.default_og_image.url }}{% elif company.logo %}{{ request.scheme }}://{{ request.get_host }}{{ company.logo.url }}{% endif %}{% endblock %}">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:locale" content="en_US">
{% if default_seo.facebook_app_id %}<meta property="fb:app_id" content="{{ default_seo.facebook_app_id }}">{% endif %}

<!-- Twitter Card -->
<meta name="twitter:card" content="{{ page_seo.twitter_card|default:'summary_large_image' }}">
<meta name="twitter:title" content="{% block twitter_title %}{{ page_seo.get_og_title|default:default_seo.default_title }}{% endblock %}">
<meta name="twitter:description" content="{% block twitter_description %}{{ page_seo.get_og_description|default:default_seo.default_description }}{% endblock %}">
<meta name="twitter:image" content="{% block twitter_image %}{% if page_seo.og_image %}{{ request.scheme }}://{{ request.get_host }}{{ page_seo.og_image.url }}{% elif default_seo.default_og_image %}{{ request.scheme }}://{{ request.get_host }}{{ default_seo.default_og_image.url }}{% elif company.logo %}{{ request.scheme }}://{{ request.get_host }}{{ company.logo.url }}{% endif %}{% endblock %}">
{% if default_seo.twitter_handle %}<meta name="twitter:site" content="@{{ default_seo.twitter_handle }}">{% endif %}

<!-- Additional SEO Meta Tags -->
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="format-detection" content="telephone=no">
<meta name="theme-color" content="#1e3c72">

<!-- Page-level Schema (if provided) -->
{% if schema_markup %}
<script type="application/ld+json">{{ schema_markup|safe }}</script>
{% endif %}

<!-- Structured Data (JSON-LD) -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{{ default_seo.schema_org_type|default:'LocalBusiness' }}",
  "name": "{{ company.company_name|default:'Blue Diamond Service Center' }}",
  "description": "{{ company.description|default:default_seo.default_description }}",
  {% if company.logo %}"logo": "{{ request.scheme }}://{{ request.get_host }}{{ company.logo.url }}",{% endif %}
  {% if company.address %}"address": {
    "@type": "PostalAddress",
    "streetAddress": "{{ company.address }}"
  },{% endif %}
  {% if company.phone_number %}"telephone": "{{ company.phone_number }}",{% endif %}
  {% if company.email %}"email": "{{ company.email }}",{% endif %}
  "url": "{{ request.scheme }}://{{ request.get_host }}",
  {% if company.facebook_url or company.twitter_url or company.instagram_url or company.linkedin_url %}"sameAs": [
    {% if company.facebook_url %}"{{ company.facebook_url }}"{% if company.twitter_url or company.instagram_url or company.linkedin_url %},{% endif %}{% endif %}
    {% if company.twitter_url %}"{{ company.twitter_url }}"{% if company.instagram_url or company.linkedin_url %},{% endif %}{% endif %}
    {% if company.instagram_url %}"{{ company.instagram_url }}"{% if company.linkedin_url %},{% endif %}{% endif %}
    {% if company.linkedin_url %}"{{ company.linkedin_url }}"{% endif %}
  ],{% endif %}
  "priceRange": "$$",
  "serviceArea": {
    "@type": "Place",
    "name": "Nepal"
  }
}
</script>

<!-- Google Analytics (GA4) -->
{% if default_seo.google_analytics_id %}
<script async src="https://www.googletagmanager.com/gtag/js?id={{ default_seo.google_analytics_id }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', '{{ default_seo.google_analytics_id }}');
</script>
{% endif %}

<!-- Google Tag Manager -->
{% if default_seo.google_tag_manager_id %}
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','{{ default_seo.google_tag_manager_id }}');</script>
{% endif %}